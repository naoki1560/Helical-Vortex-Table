<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Helical Vortex Periodic Table</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; color: #fff; font-family: "Helvetica Neue", Arial, sans-serif; }
        #info {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0, 0, 0, 0.85); padding: 15px;
            border-left: 4px solid #00ffff;
            border-radius: 4px; pointer-events: none; z-index: 10;
            max-width: 300px;
        }
        h1 { margin: 0 0 10px 0; font-size: 20px; color: #00ffff; letter-spacing: 1px; }
        p { margin: 5px 0; font-size: 13px; color: #ddd; }
        
        #legend {
            position: absolute; top: 10px; right: 10px;
            background: rgba(0, 0, 0, 0.85); padding: 10px;
            border-radius: 4px; z-index: 10; font-size: 12px;
        }
        .key-item { display: flex; align-items: center; margin-bottom: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
    </style>
</head>
<body>
    <div id="info">
        <h1>Helical Vortex Table</h1>
        <p>Drag to Rotate | Pinch to Zoom</p>
        <p style="color:#aaa;">Symbol labels are always visible.</p>
    </div>

    <div id="legend">
        <div style="margin-bottom:5px; font-weight:bold; color:#ccc;">Orbitals</div>
        <div class="key-item"><span class="dot" style="background:#ff4444;"></span>s-block</div>
        <div class="key-item"><span class="dot" style="background:#ffff44;"></span>p-block</div>
        <div class="key-item"><span class="dot" style="background:#4444ff;"></span>d-block</div>
        <div class="key-item"><span class="dot" style="background:#44ff44;"></span>f-block</div>
        <div class="key-item"><span class="dot" style="background:#ff00ff;"></span>Future</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // 元素記号リスト (1-118 + Future)
        const symbols = [
            "", "H", "He", "Li", "Be", "B", "C", "N", "O", "F", "Ne",
            "Na", "Mg", "Al", "Si", "P", "S", "Cl", "Ar", "K", "Ca",
            "Sc", "Ti", "V", "Cr", "Mn", "Fe", "Co", "Ni", "Cu", "Zn",
            "Ga", "Ge", "As", "Se", "Br", "Kr", "Rb", "Sr", "Y", "Zr",
            "Nb", "Mo", "Tc", "Ru", "Rh", "Pd", "Ag", "Cd", "In", "Sn",
            "Sb", "Te", "I", "Xe", "Cs", "Ba", "La", "Ce", "Pr", "Nd",
            "Pm", "Sm", "Eu", "Gd", "Tb", "Dy", "Ho", "Er", "Tm", "Yb",
            "Lu", "Hf", "Ta", "W", "Re", "Os", "Ir", "Pt", "Au", "Hg",
            "Tl", "Pb", "Bi", "Po", "At", "Rn", "Fr", "Ra", "Ac", "Th",
            "Pa", "U", "Np", "Pu", "Am", "Cm", "Bk", "Cf", "Es", "Fm",
            "Md", "No", "Lr", "Rf", "Db", "Sg", "Bh", "Hs", "Mt", "Ds",
            "Rg", "Cn", "Nh", "Fl", "Mc", "Lv", "Ts", "Og"
        ];

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 80, 140);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.autoRotate = true;

        scene.add(new THREE.AmbientLight(0x888888));
        const pl = new THREE.PointLight(0xffffff, 1.2, 0);
        pl.position.set(0, 100, 50);
        scene.add(pl);

        // 文字ラベルを作る関数（画像として生成）
        function makeTextSprite(message, color) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 128; canvas.height = 64; // 解像度
            ctx.font = "Bold 40px Arial";
            ctx.fillStyle = "white"; 
            ctx.textAlign = "center";
            ctx.fillText(message, 64, 48);
            
            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ map: texture, transparent: true });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(4, 2, 1); // 文字の大きさ調整
            return sprite;
        }

        const elements = [];
        const colors = { s: 0xff4444, p: 0xffff44, d: 0x4444ff, f: 0x44ff44, future: 0xff00ff };

        for (let z = 1; z <= 126; z++) {
            let color = colors.d;
            if ([1,2,3,4,11,12,19,20,37,38,55,56,87,88,119,120].includes(z)) color = colors.s;
            else if ([5,6,7,8,9,10,13,14,15,16,17,18,31,32,33,34,35,36,49,50,51,52,53,54,81,82,83,84,85,86,113,114,115,116,117,118].includes(z)) color = colors.p;
            else if ((z >= 57 && z <= 71) || (z >= 89 && z <= 103)) color = colors.f;
            else if (z > 118) color = colors.future;

            elements.push({ z: z, color: color });
        }

        const geometry = new THREE.SphereGeometry(1.5, 16, 16);
        const group = new THREE.Group();

        elements.forEach(el => {
            const maxR = 65;
            const radius = maxR - (el.z * 0.4);
            const theta = el.z * 0.5;
            const y = -el.z * 1.0 + 60;
            const x = radius * Math.cos(theta);
            const z_pos = radius * Math.sin(theta);

            // 原子（球体）
            const mat = new THREE.MeshPhongMaterial({ color: el.color });
            const atom = new THREE.Mesh(geometry, mat);
            atom.position.set(x, y, z_pos);
            group.add(atom);

            // 文字ラベル（球体の少し上に配置）
            const symbolStr = symbols[el.z] || String(el.z); // 119以降は数字を表示
            const label = makeTextSprite(symbolStr);
            label.position.set(x, y + 2.5, z_pos); // 球体の真上に浮かべる
            group.add(label);
            
            // ガイド線
            const lineGeo = new THREE.BufferGeometry().setFromPoints([
                new THREE.Vector3(x, y, z_pos), new THREE.Vector3(0, y, 0)
            ]);
            scene.add(new THREE.Line(lineGeo, new THREE.LineBasicMaterial({color:0x333333, opacity:0.3, transparent:true})));
        });

        scene.add(group);
        scene.add(new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 200, 8), new THREE.MeshBasicMaterial({color:0x444444})));

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
